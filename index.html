<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>📊 דוח פיננסי - כרטיסיות מעוצבות</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap');
    body {
      font-family: 'Heebo', sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 20px;
      color: #2c3e50;
      direction: rtl;
    }
    h1 {
      text-align: center;
      font-size: 2.5rem;
      color: #34495e;
      margin-bottom: 30px;
    }
    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .card {
      background: white;
      border-radius: 15px;
      padding: 24px;
      box-shadow: 0 4px 18px rgba(0,0,0,0.1);
      transition: 0.25s ease;
    }
    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.15);
    }
    .date {
      font-weight: 700;
      font-size: 1.3rem;
      color: #1abc9c;
      border-bottom: 2px solid #1abc9c;
      margin-bottom: 16px;
      padding-bottom: 6px;
    }
    .item {
      margin-bottom: 12px;
      font-size: 1.05rem;
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid #ecf0f1;
      padding-bottom: 6px;
    }
    .item:last-child {
      border: none;
      margin-bottom: 0;
    }
    .notes {
      display: flex;
      align-items: center;
      font-weight: bold;
      color: #27ae60;
      margin-top: 10px;
    }
    .notes.negative {
      color: #e74c3c;
    }
  </style>
</head>
<body>

  <h1>📊 דוח פיננסי - עדכונים</h1>
  <div class="container" id="container">טוען נתונים...</div>

  <script>
    function parseGoogleSheetsData(response) {
      try {
        const row = response.table.rows[0].c;

        const cash = row[0]?.v || 0;
        const currentAcc = row[1]?.v || 0;
        const deposit = row[2]?.v || 0;
        const savingsFund = row[3]?.v || 0;
        const pensionFund = row[4]?.v || 0;
        const totalAssets = row[5]?.v || 0;
        const growth = row[6]?.v || 0;
        const growthPercentRaw = row[7]?.v || 0;
        const peakGrowthDate = row[8]?.f || '—';
        const avgGrowth = row[9]?.v || 0;
        const notes = row[10]?.v || 'אין הערות';

        const isPositive = notes.includes('✅');

        const data = {
          cash,
          currentAcc,
          deposit,
          savingsFund,
          pensionFund,
          totalAssets,
          growth,
          growthPercentRaw,
          peakGrowthDate,
          avgGrowth,
          notes,
          notesStatus: isPositive ? 'positive' : 'negative'
        };

        renderCard(data);
      } catch (err) {
        document.getElementById('container').innerHTML = '<p style="color:red;">שגיאה בעיבוד הנתונים</p>';
      }
    }

function renderCard(data) {
  const container = document.getElementById('container');
  container.innerHTML = '';

  // המרה לאחוז עם 2 ספרות אחרי הנקודה
  const growthPercentFormatted = (typeof data.growthPercentRaw === 'number')
    ? (data.growthPercentRaw * 100).toFixed(2) + '%'
    : data.growthPercentRaw;

  // קביעה של צבע לפי הערך (חיובי = ירוק, שלילי = אדום, 0 = שחור)
  let growthColor = '#000'; // ברירת מחדל - שחור
  if (typeof data.growthPercentRaw === 'number') {
    if (data.growthPercentRaw > 0) growthColor = '#27ae60';    // ירוק
    else if (data.growthPercentRaw < 0) growthColor = '#e74c3c'; // אדום
  }

  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <div class="date">🗓️ חודש שיא צמיחה: ${data.peakGrowthDate}</div>
    <div class="item"><strong>💰 מזומן:</strong> ${data.cash.toLocaleString('he-IL', {style:'currency', currency:'ILS'})}</div>
    <div class="item"><strong>🏦 עו"ש:</strong> ${data.currentAcc.toLocaleString('he-IL', {style:'currency', currency:'ILS'})}</div>
    <div class="item"><strong>🏛️ פיקדון (4%):</strong> ${data.deposit.toLocaleString('he-IL', {style:'currency', currency:'ILS'})}</div>
    <div class="item"><strong>🎓 קרן השתלמות:</strong> ${data.savingsFund.toLocaleString('he-IL', {style:'currency', currency:'ILS'})}</div>
    <div class="item"><strong>🛡️ קרן פנסיה:</strong> ${data.pensionFund.toLocaleString('he-IL', {style:'currency', currency:'ILS'})}</div>
    <div class="item"><strong>📈 סך נכסים נוכחי:</strong> ${data.totalAssets.toLocaleString('he-IL', {style:'currency', currency:'ILS'})}</div>
    <div class="item"><strong>📊 צמיחה:</strong> ${data.growth.toLocaleString('he-IL', {style:'currency', currency:'ILS'})}</div>
	<div class="item"><strong>📉 אחוז צמיחה:</strong> <span style="color:${growthColor}; font-weight: bold;">${growthPercentFormatted}</span></div>
    <div class="item"><strong>📅 צמיחה ממוצעת:</strong> ${data.avgGrowth.toLocaleString('he-IL', {style:'currency', currency:'ILS'})}</div>
    <div class="item notes ${data.notesStatus === 'positive' ? '' : 'negative'}">${data.notes}</div>
  `;
  container.appendChild(card);
}

    const script = document.createElement('script');
    script.src = "https://docs.google.com/spreadsheets/d/19dofQI-ay91ZAq40-fySZMdh_riryWmXGpqdbvqVb34/gviz/tq?tqx=out:jsonp&sheet=סיכום%20חסכונות&gid=425922794";
    script.onerror = () => {
      document.getElementById('container').innerHTML = '<p style="color:red;">אירעה שגיאה בטעינת הדו"ח.</p>';
    };
    document.body.appendChild(script);

    window.google = { visualization: { Query: { setResponse: parseGoogleSheetsData } } };
  </script>

</body>
</html>
